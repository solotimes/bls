extends index

block sidebar
  h1 用户试卷管理
  ul.sidenav
    each scope in scopes
      if currentUser.checkRoles(scope.roles,'试卷上传')
        li(class= (req.param('scope')||'') == scope.value ? 'current' : '')
          a(href='/customer_papers/recorded/#{scope.value}')=scope.name || scope.value

block content
  .toolbar
    a.btn.btn-green.btn-round(href='#' , data-type='refresh') 刷新
    if currentUser.checkRoles(['分配员'])
      a.btn.btn-green.btn-round(href='#' , data-type='delete-selected') 删除
    form(method='get').search
      select(name='by')
        option(value='Name',selected=collection.by=='Name') 试卷标题
        option(value='CodeName' ,selected=collection.by=='CodeName') 试卷编号
        option(value='CreatedAt' ,selected=collection.by=='CreatedAt') 上传日期
        option(value='AssignedTo' ,selected=collection.by=='AssignedTo') 录入员
        option(value='CustomerName' ,selected=collection.by=='CustomerName') 会员名
      input(name='q',value='#{collection.q||''}')
      button(type='submit').btn.btn-blue 搜索
  .main
    form#select(method='post' ,action='/customer_papers')
      input(type='hidden',name='_method',value='delete')
      table
        thead
          tr
            th.span25px
              input(type='checkbox',data-type='select-all')
            th 编号
            th 状态
            th 录入员
            th 会员名
            th 会员类别
            th 试卷标题
            th 上传时间
            th 录入时间
            th.span230px 操作
        tbody
          each model, i in collection
            - var cls = [(i % 2 == 0) ? 'odd' : 'even']
            - cls.push(model.lorder === 4 ? ' highlight' : null)
            tr(class=cls)
              td
                input(type='checkbox',value=model.id,data-type='select',name='ids[]')
              td= model.CodeName
              td
                span.status(class='status-#{model.Status}')=model.statusText()
              td
                if model.assignedTo && model.assignedTo.Name
                  =model.assignedTo.Name
                else
                  |未分配
              td= model.customer.Name
              td= model.lname
              td(style='text-align:left')= model.Name
              td
                if model.CreatedAt
                  = moment(model.CreatedAt).format('YYYY-MM-DD HH:mm')
              td
                if model.RecordedAt
                  = moment(model.RecordedAt).format('YYYY-MM-DD HH:mm')
              td
                if model.Status == 6 || model.Status == 7
                  a(href='/customer_papers/#{model.id}#report',data-type='report',target='_blank') 报告
                else
                  a.hidden 占位
                a(href='/customer_papers/#{model.id}',data-type='view',target='_blank') 查看
                if model.Status != 7
                  a(href='/customer_papers/#{model.id}#edit',data-type='edit',target='_blank') 修改
                else
                  a.hidden 占位
                if model.Status==6 || model.Status==8 || model.Status==7
                  if !model.PaperId
                    a(href='/customer_papers/#{model.id}/dump',data-type='dump',data-method='post',data-confirm='你确定要将本试卷导入试卷库?') 存入库
                  else
                    span.gray 已入库
                else
                  a(style='visibility:hidden') 存入库
                //- if currentUser.checkRoles(['分配员'])
                  //- a(data-type='delete', href='/customer_papers/#{model.id}' , data-method='delete' , data-confirm='确定删除本记录?' , rel="nofollow") 删除
    .pagination
      != paginate(collection)
